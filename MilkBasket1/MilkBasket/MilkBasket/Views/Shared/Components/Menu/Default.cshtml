@model List<MilkBasket.Models.MenuViewModel>

@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

@{
    var currentUrl = HttpContextAccessor.HttpContext.Request.Path.Value?.ToLower() ?? "";
    var collapseIndex = 0;
}

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

<style>
    .sidebar-menu a {
        color: white;
        text-decoration: none;
        padding: 10px 20px;
        display: block;
        transition: background 0.3s;
    }

    .sidebar-menu a:hover {
        background-color: rgba(255, 255, 255, 0.1);
    }

    .sidebar-menu .submenu a {
        padding-left: 40px;
        font-size: 0.95rem;
    }

    .sidebar-menu a.active {
        background-color: red;
    }
</style>

<div class="sidebar-menu bg-primary text-white d-flex flex-column" style="min-height: 100vh; padding-top: 1rem;">
    @foreach (var menu in Model ?? new List<MilkBasket.Models.MenuViewModel>())
    {
        var collapseId = $"collapseMenu{collapseIndex++}";
        var hasSub = menu.SubMenus != null && menu.SubMenus.Any();
        var isActiveParent = hasSub && menu.SubMenus.Any(s => !string.IsNullOrEmpty(s.MenuUrl) && currentUrl.Contains(s.MenuUrl.ToLower()));

        if (hasSub)
        {
            <a class="sidebar-link d-flex align-items-center @(isActiveParent ? "active" : "")"
               data-bs-toggle="collapse"
               href="#@collapseId"
               role="button"
               aria-expanded="@isActiveParent.ToString().ToLower()">
                <i class="fas fa-arrow-down me-2"></i> @menu.MenuName
            </a>

            <div class="collapse submenu @(isActiveParent ? "show" : "")" id="@collapseId">
                @foreach (var submenu in menu.SubMenus)
                {
                    var url = submenu.MenuUrl ?? "#";
                    var name = submenu.SubMenuName ?? "(Unnamed)";
                    var isActive = !string.IsNullOrEmpty(submenu.MenuUrl) && currentUrl.Contains(submenu.MenuUrl.ToLower());

                    <a href="~/@url" class="sidebar-link @(isActive ? "active" : "")">
                        <i class="fas fa-circle-notch me-1"></i> @name
                    </a>
                }
            </div>
        }
        else
        {
            var url = menu.MenuUrl ?? "#";
            var isActive = !string.IsNullOrEmpty(menu.MenuUrl) && currentUrl.Contains(menu.MenuUrl.ToLower());

            <a href="~/@url" class="sidebar-link d-flex align-items-center @(isActive ? "active" : "")">
                <i class="fas fa-bars me-2"></i> @(menu.MenuName ?? "(Unnamed)")
            </a>
        }
    }
</div>
